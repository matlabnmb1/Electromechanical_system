# 检查记录可见性测试脚本
# 这个脚本用于帮助诊断为什么用户在界面上看不到保存的记录

import sqlite3
import json
import os

# 尝试连接到MySQL数据库
# 由于直接在脚本中连接MySQL可能比较复杂，我们将创建一个简单的测试来分析问题

print("=== 记录可见性测试工具 ===")
print("这个工具将帮助分析为什么在界面上看不到保存的记录")
print("\n请确保您已经阅读了下面的分析指南：")

print("\n【问题分析指南】")
print("1. 检查您的用户角色和所属区队")
print("   - 超级管理员：可以查看所有记录")
print("   - 管理员：只能查看自己区队的记录")
print("   - 普通用户：只能查看自己区队的记录")

print("\n2. 检查记录与模板的关联")
print("   - 每条记录都必须关联一个有效的模板")
print("   - 如果模板被删除，关联的记录也会被删除（级联删除）")

print("\n3. 检查区队匹配")
print("   - 普通用户和管理员只能查看与自己区队相同的记录")
print("   - 确保您创建的记录所属的模板区队与您的用户区队匹配")

print("\n4. 检查数据格式")
print("   - 记录数据以JSON格式存储在数据库中")
print("   - 确保数据格式正确，没有损坏")

print("\n【可能的解决方案】")
print("1. 确认您的登录状态和用户信息正确")
print("2. 确认您正在查看的记录与您的权限匹配")
print("3. 如果是管理员，确保您的区队设置正确")
print("4. 检查模板是否仍然存在，且区队设置正确")

print("\n【技术提示】")
print("- 登录问题：检查session中是否有'loggedin'标记")
print("- 权限问题：检查session中的'role'和'team'值")
print("- 数据关联：确保check_records表中的template_id存在于check_templates表中")

print("\n请尝试以下操作：")
print("1. 以超级管理员身份登录，查看是否能看到所有记录")
print("2. 检查您创建的记录是否正确关联了模板")
print("3. 确认模板的区队设置与您的用户区队匹配")
print("4. 清除浏览器缓存，重新登录系统")

print("\n如果问题依然存在，请联系系统管理员查看服务器日志以获取更多信息。")